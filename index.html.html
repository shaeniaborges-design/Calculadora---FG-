<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Promoções - FG</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f8f9fa; color: #2D2D2D; line-height: 1.6; text-align: left; }
        .header { background-color: #EA1D2C; color: white; padding: 15px 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; }
        .header h1 { font-size: 24px; font-weight: 600; grid-column: 2; text-align: center; }
        .header img { height: 45px; width: auto; grid-column: 3; justify-self: end; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .tabs { display: flex; background-color: white; border-radius: 8px 8px 0 0; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); justify-content: flex-start; }
        .tab { flex: 1; padding: 15px 20px; text-align: center; cursor: pointer; border: none; background-color: #e0e0e0; color: #666; font-size: 14px; font-weight: 600; transition: all 0.3s ease; border-bottom: 3px solid transparent; }
        .tab.active { background-color: #EA1D2C; color: white; border-bottom: 3px solid #c41625; }
        .tab-content { display: none; background-color: white; border-radius: 0 0 8px 8px; padding: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-content.active { display: block; }
        .secao-header { display: flex; justify-content: flex-start; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        .acoes-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn-download { background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 13px; display: none; transition: 0.2s; }
        .btn-limpar-padrao { background-color: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 13px; font-weight: 600; display: none; transition: 0.2s; }
        
        .missoes-input-grid { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; }
        .missao-input-card { flex: 1; min-width: 250px; background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; border-top: 4px solid #EA1D2C; }
        .missao-input-card h3 { color: #EA1D2C; font-size: 14px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .form-row { display: flex; gap: 20px; margin-bottom: 15px; flex-wrap: wrap; width: 100%; }
        .form-group { flex: 1; min-width: 200px; }
        label { display: block; font-weight: 600; color: #2D2D2D; margin: 10px 0 5px 0; font-size: 14px; }
        input, select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 14px; }
        
        .grid-config { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; align-items: start; }
        .regras-semanais { width: 100%; border-collapse: separate; border-spacing: 0; background: #fff; border: 1px solid #dee2e6; border-radius: 12px; overflow: hidden; text-align: left; }
        .regras-semanais th { background: #f8f9fa; color: #495057; padding: 12px; font-size: 13px; font-weight: 700; border-bottom: 2px solid #dee2e6; text-align: left; }
        .regras-semanais td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; }
        .toggle-btn { padding: 6px 18px; border: 2px solid #dee2e6; background: #fff; color: #adb5bd; border-radius: 20px; cursor: pointer; font-size: 11px; font-weight: 800; min-width: 75px; transition: 0.2s; }
        .toggle-btn.active { background: #EA1D2C; color: white; border-color: #EA1D2C; }
        .regioes-box { background: #fff; padding: 15px; border: 1px solid #dee2e6; border-radius: 12px; }
        .regiao-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
        .regiao-row:last-child { border-bottom: none; }
        
        .btn-processar { background-color: #EA1D2C; color: white; border: none; padding: 12px 30px; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; margin: 20px 0; }
        .btn-processar:disabled { background-color: #ccc; cursor: not-allowed; }
        .resultados-grid { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px; display: none; }
        .resultados-grid.show { display: flex; }
        .resultado-card { flex: 1; min-width: 220px; background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; border-top: 4px solid #EA1D2C; }
        .card-valor { color: #EA1D2C; font-weight: bold; }
        .tabela-container { display: none; max-height: 400px; overflow: auto; margin-top: 15px; border: 1px solid #e0e0e0; border-radius: 4px; }
        .tabela-container.show { display: block; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background-color: #EA1D2C; color: white; padding: 10px; text-align: left; position: sticky; top: 0; }
        td { padding: 8px; border-bottom: 1px solid #f0f0f0; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; min-height: 45px; padding: 10px; border: 1px dashed #ccc; border-radius: 5px; background: #fafafa; margin-top: 5px;}
    </style>
</head>
<body>
    <header class="header">
        <h1>Calculadora de Promoções - FG</h1>
        <img src="614203733812642dd9d0a6f1_ifood-logo-01.png" alt="Logo">
    </header>

    <div class="container">
        <div class="tabs">
            <button class="tab" onclick="openTab(event, 'destrave')">Destrave e Ganhe</button>
            <button class="tab" onclick="openTab(event, 'rota')">Bônus de Rota</button>
            <button class="tab active" onclick="openTab(event, 'extra')">Incentivo Extra</button>
        </div>

        <div id="extra" class="tab-content active">
            <div class="secao-header"><h3>Incentivo Extra</h3></div>
            <div class="form-row">
                <div class="form-group"><label>Data Início</label><input type="date" id="extra_data_inicio"></div>
                <div class="form-group"><label>Data Fim</label><input type="date" id="extra_data_fim"></div>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Valor Turno (R$)</label><input type="number" id="extra_valor_turno"></div>
                <div class="form-group"><label>Aderência Mínima (%)</label><input type="number" id="extra_aderencia_min" step="0.01"></div>
            </div>
            <div class="grid-config">
                <div class="form-group">
                    <label>Selecione os Turnos:</label>
                    <table class="regras-semanais" id="tabela_regras">
                        <thead><tr><th>Dia</th><th>Almoço</th><th>Jantar</th></tr></thead>
                        <tbody>
                            <tr data-dia="5"><td>Sexta</td><td><button class="toggle-btn" onclick="toggleBtn(this)">NÃO</button></td><td><button class="toggle-btn" onclick="toggleBtn(this)">NÃO</button></td></tr>
                            <tr data-dia="6"><td>Sábado</td><td><button class="toggle-btn" onclick="toggleBtn(this)">NÃO</button></td><td><button class="toggle-btn" onclick="toggleBtn(this)">NÃO</button></td></tr>
                            <tr data-dia="0"><td>Domingo</td><td><button class="toggle-btn" onclick="toggleBtn(this)">NÃO</button></td><td><button class="toggle-btn" onclick="toggleBtn(this)">NÃO</button></td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="form-group">
                    <label>Escolha as Regiões:</label>
                    <div class="regioes-box">
                        <div class="regiao-row"><span style="font-weight:600;font-size:13px">Florianópolis</span><button class="toggle-btn regiao-btn" data-value="FLORIANOPOLIS" onclick="toggleBtn(this)">NÃO</button></div>
                        <div class="regiao-row"><span style="font-weight:600;font-size:13px">Florianópolis Norte</span><button class="toggle-btn regiao-btn" data-value="FLORIANOPOLIS - NORTE" onclick="toggleBtn(this)">NÃO</button></div>
                        <div class="regiao-row"><span style="font-weight:600;font-size:13px">Palhoça</span><button class="toggle-btn regiao-btn" data-value="PALHOCA" onclick="toggleBtn(this)">NÃO</button></div>
                        <div class="regiao-row"><span style="font-weight:600;font-size:13px">Sorocaba</span><button class="toggle-btn regiao-btn" data-value="SOROCABA" onclick="toggleBtn(this)">NÃO</button></div>
                    </div>
                </div>
            </div>
            <div class="form-group"><label>Upload CSV</label><input type="file" id="upload_extra" accept=".csv" onchange="validarCampos('extra')"></div>
            <div class="form-row" style="background: #fdfdfd; padding: 15px; border: 1px solid #e0e0e0; border-radius: 8px; margin-top:10px">
                <div class="form-group" style="flex: 2;"><label>Restaurantes Extras (Opcional)</label><select id="extra_restaurante_select"><option value="">Selecione regiões/arquivo primeiro...</option></select><div class="tag-container" id="extra_restaurante_tags"></div></div>
                <div class="form-group" style="flex: 1;"><label>Bônus Adicional (R$)</label><input type="number" id="extra_valor_adicional" step="0.01"></div>
            </div>
            <button class="btn-processar" id="btn_extra" disabled onclick="processarExtra()">Processar Incentivo Extra</button>
            <div class="resultados-grid" id="resultado_extra">
                <div class="resultado-card"><h4>Resultado</h4><p>Motoristas: <span id="extra_total_registros" class="card-valor">0</span></p><p>Bonificação Total: <span id="extra_total_bonificacao" class="card-valor">R$ 0,00</span></p></div>
            </div>
            <div class="acoes-footer">
                <button id="limp_extra" class="btn-limpar-padrao" onclick="limparCampos('extra')">Limpar</button>
                <button id="dl_extra" class="btn-download" onclick="baixarCSV('extra')">Baixar Relatório CSV</button>
            </div>
            <div class="tabela-container" id="tabela_extra"><table><thead><tr id="thead_extra_cols"></tr></thead><tbody id="tbody_extra"></tbody></table></div>
        </div>

        <div id="destrave" class="tab-content">
            <div class="secao-header"><h3>Destrave e Ganhe</h3></div>
            <div class="missoes-input-grid">
                <div class="missao-input-card"><h3>MISSÃO 1</h3><label>Pedidos:</label><input type="number" id="destrave_meta_nivel1"><label>Valor (R$):</label><input type="number" id="destrave_valor_nivel1" step="0.01"></div>
                <div class="missao-input-card"><h3>MISSÃO 2</h3><label>Pedidos:</label><input type="number" id="destrave_meta_nivel2"><label>Valor (R$):</label><input type="number" id="destrave_valor_nivel2" step="0.01"></div>
                <div class="missao-input-card"><h3>MISSÃO 3</h3><label>Pedidos:</label><input type="number" id="destrave_meta_nivel3"><label>Valor (R$):</label><input type="number" id="destrave_valor_nivel3" step="0.01"></div>
            </div>
            <div class="form-row"><div class="form-group"><label>Upload CSV</label><input type="file" id="upload_destrave" accept=".csv" onchange="validarCampos('destrave')"></div></div>
            <button class="btn-processar" id="btn_destrave" disabled onclick="processarDestrave()">Processar Destrave e Ganhe</button>
            <div class="resultados-grid" id="resultado_destrave">
                <div class="resultado-card"><h4>Geral</h4><p>Total Registros: <span id="destrave_total_registros" class="card-valor">0</span></p><p>Total Bonificação: <span id="destrave_total_bonificacao" class="card-valor">R$ 0,00</span></p></div>
                <div class="resultado-card"><h4>Missão 1</h4><p><span id="destrave_cont_m1" class="card-valor">0 (0%)</span></p><p><span id="destrave_boni_m1" class="card-valor">R$ 0,00</span></p></div>
                <div class="resultado-card"><h4>Missão 2</h4><p><span id="destrave_cont_m2" class="card-valor">0 (0%)</span></p><p><span id="destrave_boni_m2" class="card-valor">R$ 0,00</span></p></div>
                <div class="resultado-card"><h4>Missão 3</h4><p><span id="destrave_cont_m3" class="card-valor">0 (0%)</span></p><p><span id="destrave_boni_m3" class="card-valor">R$ 0,00</span></p></div>
            </div>
            <div class="acoes-footer">
                <button id="limp_destrave" class="btn-limpar-padrao" onclick="limparCampos('destrave')">Limpar</button>
                <button id="dl_destrave" class="btn-download" onclick="baixarCSV('destrave')">Baixar Relatório CSV</button>
            </div>
            <div class="tabela-container" id="tabela_destrave"><table><thead><tr><th>Região</th><th>ID</th><th>Pedidos</th><th>Missão</th><th>Valor</th></tr></thead><tbody id="tbody_destrave"></tbody></table></div>
        </div>

        <div id="rota" class="tab-content">
            <div class="secao-header"><h3>Bônus por Rota</h3></div>
            <div class="form-row"><div class="form-group"><label>Valor Incentivo (R$)</label><input type="number" id="rota_valor"></div><div class="form-group"><label>Rotas</label><input type="number" id="rota_pedidos_meta"></div></div>
            <div class="form-row"><div class="form-group"><label>Upload CSV</label><input type="file" id="upload_rota" accept=".csv" onchange="validarCampos('rota')"></div></div>
            <button class="btn-processar" id="btn_rota" disabled onclick="processarRota()">Processar Bônus de Rota</button>
            <div class="resultados-grid" id="resultado_rota">
                <div class="resultado-card"><h4>Geral</h4><p>Total Registros: <span id="rota_total_registros" class="card-valor">0</span></p><p>Total Bonificação: <span id="rota_total_bonificacao" class="card-valor">R$ 0,00</span></p></div>
                <div class="resultado-card"><h4>Performance</h4><p>Drivers Bonificados: <span id="rota_percent_boni" class="card-valor">0 (0%)</span></p></div>
            </div>
            <div class="acoes-footer">
                <button id="limp_rota" class="btn-limpar-padrao" onclick="limparCampos('rota')">Limpar</button>
                <button id="dl_rota" class="btn-download" onclick="baixarCSV('rota')">Baixar Relatório CSV</button>
            </div>
            <div class="tabela-container" id="tabela_rota"><table><thead><tr><th>Data</th><th>ID</th><th>Rotas</th><th>Incentivo</th></tr></thead><tbody id="tbody_rota"></tbody></table></div>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) { document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.getElementById(tabName).classList.add('active'); evt.currentTarget.classList.add('active'); }
        function toggleBtn(btn) { btn.classList.toggle('active'); btn.innerText = btn.classList.contains('active') ? 'SIM' : 'NÃO'; }
        function parseCSVLine(text) { const result = []; let current = ''; let inQuotes = false; for (let char of text) { if (char === '"') inQuotes = !inQuotes; else if (char === ',' && !inQuotes) { result.push(current.trim()); current = ''; } else current += char; } result.push(current.trim()); return result; }
        function lerCSV(arquivo) { return new Promise((resolve) => { const reader = new FileReader(); reader.onload = e => { const linhas = e.target.result.split('\n').filter(l => l.trim() !== ''); const headers = parseCSVLine(linhas[0]).map(h => h.trim().toLowerCase()); resolve(linhas.slice(1).map(linha => { const valores = parseCSVLine(linha); const obj = {}; headers.forEach((h, i) => obj[h] = valores[i]); return obj; })); }; reader.readAsText(arquivo); }); }
        function validarCampos(tipo) { document.getElementById('btn_' + tipo).disabled = !document.getElementById('upload_' + tipo).files.length; }

        let dadosCSVExtra = [], dadosDestrave = [], dadosRota = [], dadosExtraFinal = []; let restaurantesSelecionados = new Set();

        async function processarDestrave() {
            const m1 = parseInt(document.getElementById('destrave_meta_nivel1').value) || 0, v1 = parseFloat(document.getElementById('destrave_valor_nivel1').value) || 0;
            const m2 = parseInt(document.getElementById('destrave_meta_nivel2').value) || 0, v2 = parseFloat(document.getElementById('destrave_valor_nivel2').value) || 0;
            const m3 = parseInt(document.getElementById('destrave_meta_nivel3').value) || 0, v3 = parseFloat(document.getElementById('destrave_valor_nivel3').value) || 0;
            const dados = await lerCSV(document.getElementById('upload_destrave').files[0]);
            let totalBoni = 0, c1=0, c2=0, c3=0, b1=0, b2=0, b3=0;
            dadosDestrave = dados.map(item => {
                const p = parseInt(item.pedidos) || 0; let val = 0, m = 'Nenhuma';
                if (p >= m3 && m3 > 0) { val = v3; c3++; b3 += v3; m = 'Missão 3'; } else if (p >= m2 && m2 > 0) { val = v2; c2++; b2 += v2; m = 'Missão 2'; } else if (p >= m1 && m1 > 0) { val = v1; c1++; b1 += v1; m = 'Missão 1'; }
                totalBoni += val;
                return { reg: item.logistic_region || item['any_value(logistic_region)'] || 'N/A', id: item.driver_uuid, p, m, v: val.toFixed(2) };
            });
            document.getElementById('destrave_total_bonificacao').textContent = 'R$ ' + totalBoni.toLocaleString('pt-BR', {minimumFractionDigits:2});
            document.getElementById('destrave_total_registros').textContent = dados.length;
            document.getElementById('destrave_cont_m1').textContent = `${c1} (${((c1/dados.length)*100).toFixed(1)}%)`;
            document.getElementById('destrave_boni_m1').textContent = 'R$ ' + b1.toLocaleString('pt-BR', {minimumFractionDigits:2});
            document.getElementById('destrave_cont_m2').textContent = `${c2} (${((c2/dados.length)*100).toFixed(1)}%)`;
            document.getElementById('destrave_boni_m2').textContent = 'R$ ' + b2.toLocaleString('pt-BR', {minimumFractionDigits:2});
            document.getElementById('destrave_cont_m3').textContent = `${c3} (${((c3/dados.length)*100).toFixed(1)}%)`;
            document.getElementById('destrave_boni_m3').textContent = 'R$ ' + b3.toLocaleString('pt-BR', {minimumFractionDigits:2});
            document.getElementById('resultado_destrave').classList.add('show');
            document.getElementById('dl_destrave').style.display = 'block';
            document.getElementById('limp_destrave').style.display = 'block';
            exibirTabela('destrave');
        }

        async function processarRota() {
            const val = parseFloat(document.getElementById('rota_valor').value), meta = parseInt(document.getElementById('rota_pedidos_meta').value);
            const dados = await lerCSV(document.getElementById('upload_rota').files[0]);
            let totalBoni = 0, contBonificados = 0;
            dadosRota = dados.map(item => {
                const r = parseInt(item.rotas) || 0; const inc = r >= meta ? val : 0;
                if(inc > 0) { contBonificados++; totalBoni += inc; }
                return { data: item.date_partition || item['data escala'] || 'N/A', id: item.driver_uuid || item['id driver'] || 'N/A', r, v: inc.toFixed(2) };
            });
            document.getElementById('rota_total_bonificacao').textContent = 'R$ ' + totalBoni.toLocaleString('pt-BR', {minimumFractionDigits:2});
            document.getElementById('rota_total_registros').textContent = dados.length;
            document.getElementById('rota_percent_boni').textContent = `${contBonificados} (${((contBonificados/dados.length)*100).toFixed(1)}%)`;
            document.getElementById('resultado_rota').classList.add('show');
            document.getElementById('dl_rota').style.display = 'block';
            document.getElementById('limp_rota').style.display = 'block';
            exibirTabela('rota');
        }

        async function processarExtra() {
            const dIniInput = document.getElementById('extra_data_inicio').value;
            const dFimInput = document.getElementById('extra_data_fim').value;
            const dIni = new Date(dIniInput + 'T00:00:00'), dFim = new Date(dFimInput + 'T23:59:59');
            const vT = parseFloat(document.getElementById('extra_valor_turno').value), adMin = parseFloat(document.getElementById('extra_aderencia_min').value);
            const valorAdd = parseFloat(document.getElementById('extra_valor_adicional').value) || 0;
            const regioes = Array.from(document.querySelectorAll('.regiao-btn.active')).map(btn => btn.getAttribute('data-value'));
            const regras = {};
            document.querySelectorAll('#tabela_regras tbody tr').forEach(tr => { const dia = tr.getAttribute('data-dia'); const btns = tr.querySelectorAll('.toggle-btn'); regras[dia] = { almoco: btns[0].classList.contains('active'), jantar: btns[1].classList.contains('active') }; });
            if (dadosCSVExtra.length === 0) dadosCSVExtra = await lerCSV(document.getElementById('upload_extra').files[0]);
            const driversMap = {};
            dadosCSVExtra.forEach(item => {
                const rowDate = new Date(item.date_partition + 'T12:00:00'); const dia = rowDate.getDay().toString();
                let ad = parseFloat((item.aderencia || "0").toString().replace('%', '').replace(',', '.'));
                if (rowDate >= dIni && rowDate <= dFim && regioes.includes((item.logistic_region || "").toUpperCase().trim()) && ad >= (adMin - 0.0001)) {
                    const regra = regras[dia];
                    if (regra) {
                        const shift = (item.shift_name || "").toUpperCase();
                        if ((shift.includes("ALMOCO") && regra.almoco) || (shift.includes("JANTAR") && regra.jantar)) {
                            const uuid = item.driver_uuid; if (!driversMap[uuid]) driversMap[uuid] = { n: 0, r: 0 };
                            if (restaurantesSelecionados.has(item.brand_trading_name)) driversMap[uuid].r++; else driversMap[uuid].n++;
                        }
                    }
                }
            });
            let totalG = 0;
            dadosExtraFinal = Object.keys(driversMap).sort().map(id => { const d = driversMap[id]; const totalT = d.n + d.r; const totalF = (totalT * vT) + (d.r * valorAdd); totalG += totalF; return { id, turnos: totalT, total: totalF.toFixed(2) }; });
            document.getElementById('extra_total_bonificacao').textContent = 'R$ ' + totalG.toLocaleString('pt-BR', {minimumFractionDigits:2});
            document.getElementById('extra_total_registros').textContent = Object.keys(driversMap).length;
            document.getElementById('thead_extra_cols').innerHTML = '<th>ID</th><th>Turnos</th><th>Total</th>';
            document.getElementById('resultado_extra').classList.add('show');
            document.getElementById('dl_extra').style.display = 'block';
            document.getElementById('limp_extra').style.display = 'block';
            exibirTabela('extra');
        }

        function exibirTabela(tipo) { const tbody = document.getElementById('tbody_' + tipo); tbody.innerHTML = ''; const lista = (tipo === 'destrave') ? dadosDestrave : (tipo === 'rota' ? dadosRota : dadosExtraFinal); lista.forEach(item => { const tr = document.createElement('tr'); Object.values(item).forEach(v => { tr.innerHTML += `<td>${v}</td>`; }); tbody.appendChild(tr); }); document.getElementById('tabela_' + tipo).classList.add('show'); }
        function baixarCSV(tipo) { const lista = (tipo === 'destrave') ? dadosDestrave : (tipo === 'rota' ? dadosRota : dadosExtraFinal); if(!lista.length) return; const headers = Object.keys(lista[0]).join(';'); const rows = lista.map(row => Object.values(row).join(';')).join('\n'); const blob = new Blob(["\ufeff" + headers + '\n' + rows], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = `relatorio_${tipo}_fg.csv`; link.click(); }
        function limparCampos(tipo) { 
            const container = document.getElementById(tipo);
            container.querySelectorAll('input').forEach(i => i.value = "");
            container.querySelectorAll('.toggle-btn').forEach(btn => { btn.classList.remove('active'); btn.innerText = "NÃO"; });
            document.getElementById('resultado_' + tipo).classList.remove('show');
            document.getElementById('tabela_' + tipo).classList.remove('show');
            document.getElementById('dl_' + tipo).style.display = 'none';
            document.getElementById('limp_' + tipo).style.display = 'none';
            if(tipo === 'destrave') dadosDestrave = []; else if(tipo === 'rota') dadosRota = []; else { dadosExtraFinal = []; dadosCSVExtra = []; restaurantesSelecionados.clear(); document.getElementById('extra_restaurante_tags').innerHTML = ""; }
        }
        document.getElementById('upload_extra').addEventListener('change', async function() { if(!this.files.length) return; dadosCSVExtra = await lerCSV(this.files[0]); const resSet = new Set(); dadosCSVExtra.forEach(d => { if(d.brand_trading_name) resSet.add(d.brand_trading_name); }); const select = document.getElementById('extra_restaurante_select'); select.innerHTML = '<option value="">Selecione...</option>'; Array.from(resSet).sort().forEach(r => select.innerHTML += `<option value="${r}">${r}</option>`); validarCampos('extra'); });
        document.getElementById('extra_restaurante_select').addEventListener('change', function() { if(this.value && !restaurantesSelecionados.has(this.value)) { restaurantesSelecionados.add(this.value); const tag = document.createElement('div'); tag.className = 'tag'; tag.style.padding = '4px 10px'; tag.style.borderRadius = '15px'; tag.style.backgroundColor = '#EA1D2C'; tag.style.color = 'white'; tag.style.fontSize = '12px'; tag.style.fontWeight = 'bold'; tag.innerHTML = `${this.value} <span style="cursor:pointer;margin-left:5px" onclick="this.parentElement.remove(); restaurantesSelecionados.delete('${this.value}')">&times;</span>`; document.getElementById('extra_restaurante_tags').appendChild(tag); } this.value = ""; });
    </script>
</body>
</html>